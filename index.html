<!DOCTYPE html><html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ICS Generator</title>
<style>
  body { font-family: sans-serif; margin: 1rem; max-width: 1000px; padding: 1rem; background: #f5f5f5; }
  h1 { text-align: center; }
  fieldset { border-radius: 8px; border: 1px solid #ddd; padding: 1rem; margin-bottom: 1rem; background: #fff; }
  legend { font-weight: bold; }
  label { display: block; margin-top: 0.5rem; }
  input, textarea, select { width: 100%; padding: 0.4rem; margin-top: 0.2rem; border-radius: 4px; border: 1px solid #ccc; }
  input:focus, textarea:focus, select:focus { border-color: #2196F3; outline: none; box-shadow: 0 0 4px rgba(33,150,243,0.5); }
  .event { background: #fff; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
  .accordion-content { display: none; margin-top: 0.5rem; }
  .accordion-toggle { cursor: pointer; font-weight: bold; margin-bottom: 0.5rem; display: block; }
  .highlight-date { background-color: #fffbcc; padding: 0.2rem; border-radius: 4px; }
  .row { display: flex; flex-wrap: wrap; gap: 0.5rem; }
  .col { flex: 1 1 100%; }
  @media (min-width: 768px) { .col-2 { flex: 1 1 48%; } .col-3 { flex: 1 1 31%; } }
  button { margin-top: 1rem; padding: 0.6rem 1rem; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
  .add-btn { background: #4CAF50; color: white; }
  .gen-btn { background: #2196F3; color: white; margin-left: 0.5rem; }
  footer { margin-top: 2rem; font-size: 0.9rem; color: #555; text-align: center; }
</style>
</head>
<body><h1>ICS File Generator v6</h1>
<p style="font-size:0.9rem; color:#555;">Note: Timezones are a colonial standard. Provided for practical scheduling globally.</p><fieldset>
  <legend>Series Defaults</legend>
  <div class="row">
    <div class="col col-2"><label>Series Title <input type="text" id="seriesTitle" value="Event"></label></div>
    <div class="col col-2"><label>Location <input type="text" id="seriesLocation" value="Location"></label></div>
    <div class="col col-2"><label>Timezone <select id="seriesTimezone"><option value="">Select Timezone</option></select></label></div>
  </div>
  <div class="row">
    <div class="col col-2"><label>Default Start Time <input type="time" id="seriesStartTime"></label></div>
    <div class="col col-2"><label>Default End Time <input type="time" id="seriesEndTime"></label></div>
  </div>
  <label>Description <textarea id="seriesDescription" placeholder="Include meeting URL or notes here"></textarea></label>
</fieldset><div id="events"></div>
<button class="add-btn" id="addEventBtn">+ Add Event</button>
<button class="gen-btn" onclick="generateICS()">Generate ICS</button><footer>
  Made with ðŸ’š by <a href="YOUR_PORTFOLIO_LINK" target="_blank">Your Name</a>
</footer><script>
const defaultTZ = Intl.DateTimeFormat().resolvedOptions().timeZone || "Europe/Helsinki";
let eventCount = 0;
let timezonesData = [];

function escapeHTML(str) { if (!str) return ''; return str.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'", '&#39;'); }

function addEvent() {
  eventCount++;
  const container = document.getElementById('events');
  const div = document.createElement('div');
  div.className = 'event';

  const seriesTitle = escapeHTML(document.getElementById('seriesTitle').value);
  const seriesLocation = escapeHTML(document.getElementById('seriesLocation').value);
  const seriesDesc = escapeHTML(document.getElementById('seriesDescription').value);
  const seriesTZ = escapeHTML(document.getElementById('seriesTimezone').value || defaultTZ);
  const seriesStart = document.getElementById('seriesStartTime').value || '';
  const seriesEnd = document.getElementById('seriesEndTime').value || '';

  div.innerHTML = `
    <h3>Event ${eventCount}</h3>
    <label class="highlight-date">Date <input type="date" name="date" required></label>
    <span class="accordion-toggle">Show/Hide Details</span>
    <div class="accordion-content">
      <div class="row">
        <div class="col col-2"><label>Title <input type="text" name="title" value="${seriesTitle}"></label></div>
        <div class="col col-2"><label>Location <input type="text" name="location" value="${seriesLocation}"></label></div>
        <div class="col col-2"><label>Timezone <input type="text" name="timezone" list="timezones" value="${seriesTZ}"></label></div>
      </div>
      <div class="row">
        <div class="col col-2"><label>Start Time <input type="time" name="start" value="${seriesStart}"></label></div>
        <div class="col col-2"><label>End Time <input type="time" name="end" value="${seriesEnd}"></label></div>
      </div>
      <label>Description <textarea name="description">${seriesDesc}</textarea></label></div>

`;

  container.appendChild(div);

  // Add accordion toggle functionality
  const toggle = div.querySelector('.accordion-toggle');
  const content = div.querySelector('.accordion-content');
  toggle.addEventListener('click', () => { content.style.display = content.style.display === 'block' ? 'none' : 'block'; });
}

// Load timezone JSON
fetch('./timezones.json').then(res => res.json()).then(data => {
  timezonesData = data;
  const seriesInput = document.getElementById('seriesTimezone');
  data.forEach(tz => { const option = document.createElement('option'); option.value = tz.timezone; option.textContent = `${tz.city} (${tz.countryName})`; seriesInput.appendChild(option); });
  seriesInput.value = defaultTZ;
}).catch(err => console.error('Failed to load timezone JSON:', err));

function generateICS() {
  const events = document.querySelectorAll('.event');
  let ics = `BEGIN:VCALENDAR\nVERSION:2.0\nCALSCALE:GREGORIAN\nMETHOD:PUBLISH\n`;
  events.forEach((evt, i) => {
    const title = evt.querySelector('input[name="title"]').value;
    const date = evt.querySelector('input[name="date"]').value.replace(/-/g,'');
    const start = evt.querySelector('input[name="start"]').value.replace(':','') + '00';
    const end = evt.querySelector('input[name="end"]').value.replace(':','') + '00';
    const location = evt.querySelector('input[name="location"]').value;
    const desc = evt.querySelector('textarea[name="description"]').value;
    const tz = evt.querySelector('input[name="timezone"]').value;
    const uid = `evt-${i}-${Date.now()}@icsgen`;
    const dtstamp = new Date().toISOString().replace(/[-:]/g,'').split('.')[0] + 'Z';
    ics += `BEGIN:VEVENT\nUID:${uid}\nDTSTAMP:${dtstamp}\nSUMMARY:${title}\nDESCRIPTION:${desc}\nLOCATION:${location}\nDTSTART;TZID=${tz}:${date}T${start}\nDTEND;TZID=${tz}:${date}T${end}\nEND:VEVENT\n`;
  });
  ics += 'END:VCALENDAR';
  const blob = new Blob([ics], { type: 'text/calendar' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'events.ics';
  a.click();
  URL.revokeObjectURL(url);
}

// Attach add event button
document.getElementById('addEventBtn').addEventListener('click', addEvent);

// Add first event on DOM ready
window.addEventListener('DOMContentLoaded', () => addEvent());
</script>
</body>
</html>
